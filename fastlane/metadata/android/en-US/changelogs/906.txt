Resolved ANRs on new game screen with a lot of maps

Fixed errors when cloning civs that should open policy picker

By SeventhM:
- Fix promotions being available when they shouldn't
- Allow buildings to require population, Allow buildings to use condtionals

By SomeTroglodyte:
- Fix Permanent Audiovisual toggle

By tuvus:
- AI nuke improvement
- AI move units closer to enemy first in wartime
- Improved AI attack targetting

Add tests for city class and introduce small refactor  - By Framonti